<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>冒泡排序</title>
	</head>
	<style type="text/css">
		#progressContainer{
			min-width: 1100px;
			width: 100%;
			height: 150px;
			padding-left: 20%;
		}
		.block{
			width: 50px;
			background-color: red;
			float: left;
			margin-left: 10px;
			position: relative;
			transition: all 1s ease;
		}
		.block span{
			top: -20px;
			position: absolute;
			left: 15px;
		}
		#randomVal{
			margin-top: 40px;
			margin-left: 5%;
		}
		#randomVal span{
			padding: 10px;
		}
	</style>
	<div id="container">
		<p id="randomVal">随机数据为</p>
		
	</div>
</html>
<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	//用于存放排序过程中的节点
	function bubbleDom(){
		//pre和last为相邻节点，格式：{index:0,value:1} index为节点下标，value为节点值
		//exchange标记相邻节点是否交换
		this.pre={};
		this.last={};
		this.exchange=false;
	}
	//排序类
	function bubble(){
		this.inputValue=[];//排序数值
		this.sortSpeed=1000;//排序速度
		this.sortNum=10;//排序个数
		this.sortQueen=[];//用于存放排序过程中的数组
		//排序序列初始化
		this.init=function(){
			for(var i=0;i<this.inputValue.length;i++){
				(function(val){
					//数值块
					var div=$("<div class='block'></div>");
					div.height(val);
					div.css('marginTop',$('#container').height()-val);
					$('#container').append(div);
					//数值
					var span=$("<span></span>");
					span.text(val);
					div.append(span);
					var rand=$("<span></span>");
					rand.text(val);
					$('#randomVal').append(rand);
					
				})(this.inputValue[i]);
			}
		}
		//排序过程实现
		this.bubbleSort=function(arr){
			var len = arr.length;
			for (var i = 0; i < len; i++) {
				for (var j = 0; j < len - 1 - i; j++) {
					var bDom=new bubbleDom();
					bDom.pre={index:j,value:arr[j]};
					bDom.last={index:j+1,value:arr[j+1]};
					if (arr[j] > arr[j+1]) {       
						var temp = arr[j+1];       
						arr[j+1] = arr[j];
						arr[j] = temp;
						bDom.exchange=true;
					}else{
						bDom.exchange=false;
					}
					this.sortQueen.push(bDom);
				}
			}
		}
		//排序动画演示
		this.displaySort=function(bubbleDom){
			var preDom=$('#container div').eq(bubbleDom.pre.index);
			var lastDom=$('#container div').eq(bubbleDom.last.index);
			preDom.css("backgroundColor","#000000");
			lastDom.css("backgroundColor","#000000");
			setTimeout(function(){
				if(bubbleDom.exchange){
					preDom.remove();
					preDom.insertAfter(lastDom);
				} 
			},this.sortSpeed/2);
			setTimeout(function(){
				preDom.css("backgroundColor","#ff0000");
				lastDom.css("backgroundColor","#ff0000");
			},this.sortSpeed/2);
		}
		//开始排序
		this.startSort=function(){
			this.bubbleSort(this.inputValue);
			this.setSpeed(2);
			var that=this;
			for(var k=0;k<this.sortQueen.length;k++){
				(function(k){
					setTimeout(function(){
						that.displaySort(that.sortQueen[k]);
					},that.sortSpeed*k)
				})(k);
			}
		}
		//设置排序速度 1-3 速度递减，默认为2
		this.setSpeed=function(speed){
			if(speed==1){
				this.sortSpeed=500;
			}
			if(speed==2){
				this.sortSpeed=1000;
			}
			if(speed==3){
				this.sortSpeed=2000;
			}
		}
		this.randomValue=function(){
			for(var i=0;i<this.sortNum;i++){
				this.inputValue.push(Math.floor((Math.random()*100)+1));
			}
		}
	}
 
	 var bSort=new bubble();
	 bSort.randomValue();
	 bSort.init();
	 bSort.startSort();
 
</script>